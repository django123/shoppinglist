<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title Page-->
    <title>Liste des Courses</title>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

    <script th:src="@{/js/dataTables/shoppings.js}" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
    <!-- thymeleaft -->
    <link th:href="@{/css/dataTablesResponsive.css}" rel="stylesheet">
    <style>
        .pagination>li>a, .pagination>li>span { border-radius: 50% !important;margin: 0 5px;}
    </style>

</head>
<body class="userCrewWrapper">
<div th:replace="fragments/header.html:: nav"></div>


<div  id="content" style="padding-right: 15px;padding-left: 15px">
    <!--navigation-->
    </div>

    <!-- showing theses-->
    <div  style="margin-top: 5.5rem;">
        <table class="table text-center table-hover dt-responsive  table-lg display" id="shopping">
            <thead class="text-white bg-secondary">
            <tr>
                <th>Name</th>
                <th>Comment</th>
                <th>Date</th>
                <th>Status</th>
                <th>Tasks</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="shopping : ${shoppings}">
                <td th:text="${shopping.name}"></td>
                <td th:text="${shopping.comment}"></td>
                <td th:text="${shopping.date}"></td>
                <td th:text="${shopping.statut}"></td>
                <td th:if="${#lists.size(shopping.tasks)}<= 0">
                    <span th:text="${#lists.size(shopping.tasks)}"></span>&nbsp;
                    <a data-toggle="modal" data-target="#modal-add" th:attr="data-target='#modal-add'" ><i class="fa fa-plus"></i></a>
                </td>
                <td th:unless="${#lists.size(shopping.tasks)}<=0">
                    <span th:text="${#lists.size(shopping.tasks)}"></span>&nbsp;
                    <a class="btn" data-toggle="modal" data-target="#modal-add" th:attr="data-target='#modal-add'" ><i class="fa fa-plus"></i></a>
                    <a class="btn" data-toggle="modal" data-target="#modal-list" th:attr="data-target='#modal-list'" ><i class="fa fa-eye"></i></a>
                </td>
                <td>
                    <a th:href="@{/shopping/detail/}+${shopping.id_shop}" ><i class="fa fa-eye"></i></a>
                    <a class="btn" data-toggle="modal" data-target="#modal-edited" th:attr="data-target='#modal-edited'" th:href="@{/shopping/update/}+${shopping.id_shop}" ><i class="fa fa-pencil"></i></a>
                    <a class="btn" data-toggle="modal" data-target="#modal-deleted" th:attr="data-target='#modal-deleted'+${shopping.id_shop}" th:href="@{/shopping/delete/{id_shop}(id_shop=${shopping.id_shop})}">
                        <i class="fa fa-trash" ></i>
                    </a>
                </td>
                <!--Modal pour les courses-->
                <!--<div class="modal card modal-warning alert-warning fade in" th:id="modal-listed" >
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-center alert-info">
                                <h5 class="modal-title">Liste des tâches</h5>
                            </div>
                            <div class="modal-body text-center">
                                <ul th:each="task : ${shopping.tasks}">
                                    <li th:text="${task.name}"></li>
                                    <p th:text="${task.description}"></p>
                                    <a class="btn" data-toggle="modal" data-target="#modal-edit" th:attr="data-target='#modal-edit' " ><i class="fa fa-pencil"></i></a>
                                    <a data-toggle="modal" data-target="#modal-delete" th:attr="data-target='#modal-delete'"  class="btn" >
                                        <i class="fa fa-trash" ></i>
                                    </a>
                                </ul>
                                <div class="modal-footer text-center">
                                    <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>-->
                <div class="modal card modal-warning alert-warning fade in" th:id="modal-edited" >
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-center alert-info">
                                <h5 class="modal-title">modifier  une course</h5>
                            </div>
                            <div class="modal-body text-center">
                                <form th:object="${shopping}" th:action="@{/shopping/update/{id_shop}(id_shop = ${shopping.id_shop})}"method="post">
                                    <div class="form-group">
                                        <label for="nom" class="col-form-label">Nom de la course</label>
                                        <input type="text" class="form-control" id="nom" name="name" value=""/>
                                    </div>

                                    <div class="form-group">
                                        <label for="author" class="col-form-label">Date:</label>
                                        <input type="date" class="form-control" id="author" name="date" value=""/>
                                    </div>
                                    <div class="form-group">
                                        <label for="author" class="col-form-label">Comment:</label>
                                        <textarea class="form-control rounded-0" id="exampleFormControlTextarea2" rows="3"  name="comment"></textarea>
                                    </div>
                                    <div class="modal-footer text-center">
                                        <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                        <button type="submit" class="btn btn-success"><i class="fa fa-check"></i>&nbsp;Enregistrer</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal card modal-warning alert-warning fade in" th:id="modal-deleted+${shopping.id_shop}" >
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-center alert-info">
                                <h5 class="modal-title">Suppresion d'une shopping</h5>
                            </div>
                            <div class="modal-body text-center">
                                <h3>Voulez vous vraiment supprimer cette shopping?</h3>
                            </div>
                            <div class="modal-footer text-center">
                                <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                <a  class="btn btn-success"  th:href="@{/shopping/delete/{id_shop}(id_shop=${shopping.id_shop})}"><i class="fa fa-trash"></i>&nbsp;Oui</a>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Modal pour les tâhes -->
                <div class="modal card modal-warning alert-warning fade in" th:id="modal-add" >
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-center alert-info">
                                <h5 class="modal-title">Ajouter une tâche</h5>
                            </div>
                            <div class="modal-body text-center">
                                <form th:action="@{/task/save}" method="post">
                                    <div class="form-group">
                                        <label for="nom" class="col-form-label">Nom de la tâche:</label>
                                        <input type="text" class="form-control" id="nom" name="name" value=""/>
                                    </div>

                                    <div class="form-group">
                                        <label for="author" class="col-form-label">description:</label>
                                        <input type="text" class="form-control" id="author" name="description" value=""/>
                                    </div>
                                    <div class="form-group">
                                        <input type="hidden" class="form-control" id="id_shop" name="id_shop" th:value="${shopping.id_shop}">
                                    </div>
                                    <div class="modal-footer text-center">
                                        <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                        <button type="submit" class="btn btn-success"><i class="fa fa-check"></i>&nbsp;Enregistrer</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal card modal-warning alert-warning fade in" th:id="modal-list" >
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header text-center alert-info">
                                <h5 class="modal-title">Liste des tâches</h5>
                            </div>
                            <div class="modal-body text-center">
                                   <ul th:each="task : ${shopping.tasks}">
                                        <li th:text="${task.name}"></li>
                                        <p th:text="${task.description}"></p>
                                        <p th:if="${task.status}==true">
                                           <span>DONE</span>
                                           <a th:href="@{/task/active/{task_id}(task_id=${task.task_id})}">
                                           <i class="fa fa-check-circle-o"></i>
                                           </a>
                                       </p>
                                       <p th:unless="${task.status}==true">
                                           <span>TODO</span>
                                           <a th:href="@{/task/active/{task_id}(task_id=${task.task_id})}">
                                               <i class="fa fa-check-circle"></i>
                                           </a>
                                       </p>
                                        <a class="btn" data-toggle="modal" data-target="#modal-edit" th:attr="data-target='#modal-edit'" ><i class="fa fa-pencil"></i></a>
                                        <a data-toggle="modal" data-target="#modal-delete" th:attr="data-target='#modal-delete'+${task.task_id}"  class="btn" >
                                            <i class="fa fa-trash" ></i>
                                        </a>
                                        <div class="modal card modal-warning alert-warning fade in" th:id="modal-delete+${task.task_id}" >
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header text-center alert-info">
                                                        <h5 class="modal-title">Suppresion d'une tâche</h5>
                                                    </div>
                                                    <div class="modal-body text-center">
                                                        <h3>Voulez vous vraiment supprimer cette tâche?</h3>
                                                    </div>
                                                    <div class="modal-footer text-center">
                                                        <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                                        <a  class="btn btn-success"  th:href="@{/task/delete/}+${task.task_id}"><i class="fa fa-trash"></i>&nbsp;Oui</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal card modal-warning alert-warning fade in" th:id="modal-edit" >
                                            <div class="modal-dialog">
                                                <div class="modal-content">
                                                    <div class="modal-header text-center alert-info">
                                                        <h5 class="modal-title">Modifier une tâche</h5>
                                                    </div>
                                                    <div class="modal-body text-center">
                                                        <form action="#" th:object="${task}" th:action="@{/task/update/{task_id}(task_id=${task.task_id})}" method="post">
                                                            <div class="form-group">
                                                                <label for="nom" class="col-form-label">Nom de la tâche:</label>
                                                                <input type="text" class="form-control" id="nom" name="name" value=""/>
                                                            </div>

                                                            <div class="form-group">
                                                                <label for="author" class="col-form-label">description:</label>
                                                                <input type="text" class="form-control" id="author" name="description" value=""/>
                                                            </div>
                                                            <div class="form-group">

                                                            </div>
                                                            <div class="form-group">
                                                                <input type="hidden" class="form-control" id="id_shop" name="id_shop" th:value="${shopping.id_shop}">
                                                            </div>

                                                            <div class="modal-footer text-center">
                                                                <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                                                <button type="submit" class="btn btn-success"><i class="fa fa-check"></i>&nbsp;Enregistrer</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                        <div class="modal-footer text-center">
                                        <button type="button" class="btn btn-warning pull-left" data-dismiss="modal">Retour</button>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </tr>
            </tbody>
        </table>
    </div>
    <a  th:href="@{/shopping/form}" class="btn btn-primary nBtn " style="border-radius: 50%; position:fixed;bottom:1rem;right:8%;">
        <i class="fa fa-plus"></i>
    </a>

</div>
<!-- scripts-->
<script th:src="@{/js/dataTablesResponsive.js}"></script>
<script>
    $(document).ready(function () {
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
        });
        $('#back').on('click', function(){
            $('#sidebar').toggleClass('active')
        });
    });
</script>
</body>

</html>